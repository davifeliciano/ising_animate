<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>ising_animate.examples.heating API documentation</title>
<meta name="description" content="This is a module with an example of usage of the class Ising.
In this experiment, a given amount of 32 by 32 Ising models are
heaten up 0.1 degrees …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ising_animate.examples.heating</code></h1>
</header>
<section id="section-intro">
<p>This is a module with an example of usage of the class Ising.
In this experiment, a given amount of 32 by 32 Ising models are
heaten up 0.1 degrees every 60 generations (an adiabatic heating)
from 1.0 to 7.0 degrees. This is useful to plot the thermodynamic
quantities as functions of the temperature and show the phase transition
at 2.27 degrees, in energy units. At the end, the average of the mean energy
and of the specific heat over the models are ploted in terms of the
temperature, and the figure is shown and saved in the current directory.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
This is a module with an example of usage of the class Ising.
In this experiment, a given amount of 32 by 32 Ising models are
heaten up 0.1 degrees every 60 generations (an adiabatic heating)
from 1.0 to 7.0 degrees. This is useful to plot the thermodynamic 
quantities as functions of the temperature and show the phase transition 
at 2.27 degrees, in energy units. At the end, the average of the mean energy
and of the specific heat over the models are ploted in terms of the 
temperature, and the figure is shown and saved in the current directory.
&#34;&#34;&#34;

from dataclasses import dataclass, field
import multiprocessing as mp
import sys
import arrow

import numpy as np
import matplotlib.pyplot as plt
from scipy.ndimage import gaussian_filter1d

from ..ising import Ising
from ..timer import timer


plt.rcParams.update(
    {
        &#34;figure.autolayout&#34;: True,
        &#34;figure.figsize&#34;: [9.6, 4.8],
        &#34;axes.formatter.limits&#34;: (-3, 3),
    }
)


@dataclass
class PlotData:
    &#34;&#34;&#34;Class to store data of the evolution of the
    macroscopic quantities during the heating process&#34;&#34;&#34;

    temp_data: &#34;list[float]&#34; = field(default_factory=list)
    mean_energy_data: &#34;list[float]&#34; = field(default_factory=list)
    specific_heat_data: &#34;list[float]&#34; = field(default_factory=list)


class HeatingIsing(Ising):
    &#34;&#34;&#34;
    An example of usage of the Ising class. This is an Ising model
    that heat up 0.1 degrees every 60 generations (an adiabatic heating).
    This object is useful to plot the thermodynamic quantities as functions
    of the temperature and show the phase transition at 2.27 degrees,
    in energy units.
    &#34;&#34;&#34;

    def __init__(
        self,
        shape=(30, 30),
        temp=2,
        j=(1, 1),
        field=0,
        init_state=&#34;random&#34;,
    ) -&gt; None:

        super().__init__(
            shape=shape, temp=temp, j=j, field=field, init_state=init_state
        )
        self.plot = PlotData()

    def update(self):
        &#34;&#34;&#34;
        Update the Ising Model and increase the temperature in 0.1 degrees
        if the current generation is a multiple of 60
        &#34;&#34;&#34;
        super().update()
        # Increase temperature in 0.1 every 60 generations
        if not self.gen % 60:
            self.temp += 0.1
            self.plot.temp_data.append(self.temp)
            self.plot.mean_energy_data.append(np.mean(self.mean_energy_hist[-10:]))
            self.plot.specific_heat_data.append(np.mean(self.specific_heat_hist[-10:]))


def update_ising(ising):
    try:
        while ising.temp &lt;= 7.0:
            ising.update()
        return ising
    # Ignore KeyboardInterrupt on a child process
    except KeyboardInterrupt:
        pass


@timer
def heatup_isings(
    ising_list: &#34;list[HeatingIsing]&#34;, processes: int
) -&gt; &#34;list[HeatingIsing]&#34;:
    print(f&#34;Heating up {processes} Ising Models. This may take some time...&#34;)
    with mp.Pool(processes) as pool:
        try:
            return pool.map(update_ising, ising_list)
        except KeyboardInterrupt:
            # Kill the pool when KeyboardInterrupt is raised
            pool.terminate()
            pool.join()
            sys.exit(1)


def pick_user_value():
    global cores
    while True:
        try:
            return int(input(f&#34;Choose a value between 2 and {cores}: &#34;))
        except ValueError:
            print(&#34;Invalid input! Try again...\n&#34;)
            return pick_user_value()


if __name__ == &#34;__main__&#34;:
    # Ask user how many processes to use
    cores = mp.cpu_count()

    print(f&#34;Your machine has {cores} logical processors.&#34;)
    print(&#34;How many processes do you want to create for the task?&#34;)
    print(&#34;Each process will consist of a heating Ising Model and&#34;)
    print(&#34;the results will be averaged over them.&#34;, end=&#34;\n&#34;)

    processes = pick_user_value()

    if processes &lt; 2:
        print(&#34;\nToo few processes! Using 2 processes instead.&#34;)
        processes = 2
    elif processes &gt; cores:
        print(f&#34;\nToo many processes! Using {cores} processes instead.&#34;)
        processes = cores
    else:
        print(&#34;&#34;)

    # Create one instance of HeatingIsing for each process
    ising_list = [HeatingIsing(shape=(32, 32), temp=1.0) for _ in range(processes)]

    # Create processes an start computations
    print(f&#34;Initializing process pool with {processes} processes.&#34;)
    mp.set_start_method(&#34;spawn&#34;)
    ising_list = heatup_isings(ising_list, processes)

    # Average data over the HeatingIsing instances
    temp_data = ising_list[0].plot.temp_data
    mean_energy_data = np.mean(
        [ising.plot.mean_energy_data for ising in ising_list], axis=0
    )
    specific_heat_data = (
        np.mean([ising.plot.specific_heat_data for ising in ising_list], axis=0)
        / ising_list[0].lattice.spins
    )

    # Create figure and axes to plot data
    fig, axes = plt.subplots(1, 2)

    mean_energy_filtered = gaussian_filter1d(mean_energy_data, sigma=2.0)
    specific_heat_filtered = gaussian_filter1d(specific_heat_data, sigma=2.0)

    fig.suptitle(
        &#34;Specific Heat per spin and Magnetization in terms of Temperature\n&#34;
        + f&#34;Average of {processes} Ising Models&#34;
    )

    axes[0].set(xlabel=r&#34;$T$&#34;, ylabel=r&#34;$\langle E \rangle$&#34;)
    axes[0].plot(temp_data, mean_energy_data, &#34;ro&#34;, ms=3.0)
    axes[0].plot(temp_data, mean_energy_filtered, lw=1.7, zorder=-1)

    axes[1].set(xlabel=r&#34;$T$&#34;, ylabel=r&#34;$C / N$&#34;)
    axes[1].plot(temp_data, specific_heat_data, &#34;ro&#34;, ms=3.0)
    axes[1].plot(temp_data, specific_heat_filtered, lw=1.7, zorder=-1)

    for ax in axes:
        ax.grid(linestyle=&#34;:&#34;)

    time_string = arrow.now().format(&#34;YYYY-MM-DD_HH-mm&#34;)
    fig_outfile = f&#34;heating_{time_string}.png&#34;
    print(f&#34;Figure saved as {fig_outfile}&#34;)

    fig.savefig(fig_outfile)
    plt.show()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ising_animate.examples.heating.pick_user_value"><code class="name flex">
<span>def <span class="ident">pick_user_value</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def pick_user_value():
    global cores
    while True:
        try:
            return int(input(f&#34;Choose a value between 2 and {cores}: &#34;))
        except ValueError:
            print(&#34;Invalid input! Try again...\n&#34;)
            return pick_user_value()</code></pre>
</details>
</dd>
<dt id="ising_animate.examples.heating.update_ising"><code class="name flex">
<span>def <span class="ident">update_ising</span></span>(<span>ising)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_ising(ising):
    try:
        while ising.temp &lt;= 7.0:
            ising.update()
        return ising
    # Ignore KeyboardInterrupt on a child process
    except KeyboardInterrupt:
        pass</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ising_animate.examples.heating.HeatingIsing"><code class="flex name class">
<span>class <span class="ident">HeatingIsing</span></span>
<span>(</span><span>shape=(30, 30), temp=2, j=(1, 1), field=0, init_state='random')</span>
</code></dt>
<dd>
<div class="desc"><p>An example of usage of the Ising class. This is an Ising model
that heat up 0.1 degrees every 60 generations (an adiabatic heating).
This object is useful to plot the thermodynamic quantities as functions
of the temperature and show the phase transition at 2.27 degrees,
in energy units.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class HeatingIsing(Ising):
    &#34;&#34;&#34;
    An example of usage of the Ising class. This is an Ising model
    that heat up 0.1 degrees every 60 generations (an adiabatic heating).
    This object is useful to plot the thermodynamic quantities as functions
    of the temperature and show the phase transition at 2.27 degrees,
    in energy units.
    &#34;&#34;&#34;

    def __init__(
        self,
        shape=(30, 30),
        temp=2,
        j=(1, 1),
        field=0,
        init_state=&#34;random&#34;,
    ) -&gt; None:

        super().__init__(
            shape=shape, temp=temp, j=j, field=field, init_state=init_state
        )
        self.plot = PlotData()

    def update(self):
        &#34;&#34;&#34;
        Update the Ising Model and increase the temperature in 0.1 degrees
        if the current generation is a multiple of 60
        &#34;&#34;&#34;
        super().update()
        # Increase temperature in 0.1 every 60 generations
        if not self.gen % 60:
            self.temp += 0.1
            self.plot.temp_data.append(self.temp)
            self.plot.mean_energy_data.append(np.mean(self.mean_energy_hist[-10:]))
            self.plot.specific_heat_data.append(np.mean(self.specific_heat_hist[-10:]))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="ising_animate.ising.Ising" href="../ising.html#ising_animate.ising.Ising">Ising</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="ising_animate.examples.heating.HeatingIsing.update"><code class="name flex">
<span>def <span class="ident">update</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Update the Ising Model and increase the temperature in 0.1 degrees
if the current generation is a multiple of 60</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update(self):
    &#34;&#34;&#34;
    Update the Ising Model and increase the temperature in 0.1 degrees
    if the current generation is a multiple of 60
    &#34;&#34;&#34;
    super().update()
    # Increase temperature in 0.1 every 60 generations
    if not self.gen % 60:
        self.temp += 0.1
        self.plot.temp_data.append(self.temp)
        self.plot.mean_energy_data.append(np.mean(self.mean_energy_hist[-10:]))
        self.plot.specific_heat_data.append(np.mean(self.specific_heat_hist[-10:]))</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="ising_animate.examples.heating.PlotData"><code class="flex name class">
<span>class <span class="ident">PlotData</span></span>
<span>(</span><span>temp_data: list[float] = &lt;factory&gt;, mean_energy_data: list[float] = &lt;factory&gt;, specific_heat_data: list[float] = &lt;factory&gt;)</span>
</code></dt>
<dd>
<div class="desc"><p>Class to store data of the evolution of the
macroscopic quantities during the heating process</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class PlotData:
    &#34;&#34;&#34;Class to store data of the evolution of the
    macroscopic quantities during the heating process&#34;&#34;&#34;

    temp_data: &#34;list[float]&#34; = field(default_factory=list)
    mean_energy_data: &#34;list[float]&#34; = field(default_factory=list)
    specific_heat_data: &#34;list[float]&#34; = field(default_factory=list)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="ising_animate.examples.heating.PlotData.mean_energy_data"><code class="name">var <span class="ident">mean_energy_data</span> : list[float]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="ising_animate.examples.heating.PlotData.specific_heat_data"><code class="name">var <span class="ident">specific_heat_data</span> : list[float]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="ising_animate.examples.heating.PlotData.temp_data"><code class="name">var <span class="ident">temp_data</span> : list[float]</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ising_animate.examples" href="index.html">ising_animate.examples</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="ising_animate.examples.heating.pick_user_value" href="#ising_animate.examples.heating.pick_user_value">pick_user_value</a></code></li>
<li><code><a title="ising_animate.examples.heating.update_ising" href="#ising_animate.examples.heating.update_ising">update_ising</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ising_animate.examples.heating.HeatingIsing" href="#ising_animate.examples.heating.HeatingIsing">HeatingIsing</a></code></h4>
<ul class="">
<li><code><a title="ising_animate.examples.heating.HeatingIsing.update" href="#ising_animate.examples.heating.HeatingIsing.update">update</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="ising_animate.examples.heating.PlotData" href="#ising_animate.examples.heating.PlotData">PlotData</a></code></h4>
<ul class="">
<li><code><a title="ising_animate.examples.heating.PlotData.mean_energy_data" href="#ising_animate.examples.heating.PlotData.mean_energy_data">mean_energy_data</a></code></li>
<li><code><a title="ising_animate.examples.heating.PlotData.specific_heat_data" href="#ising_animate.examples.heating.PlotData.specific_heat_data">specific_heat_data</a></code></li>
<li><code><a title="ising_animate.examples.heating.PlotData.temp_data" href="#ising_animate.examples.heating.PlotData.temp_data">temp_data</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>